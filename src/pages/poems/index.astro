---
import { siteConfig } from '@/config/site';

import poems from '@/lib/poems';

import Layout from '@/components/Layout.astro';
import Poem from '@/components/screens/poems/Poem.astro';
import Back from '@/components/elements/Back';

const poemsValue = await poems();
---

<Layout
	meta={{
		title: `Poetry Collection - ${siteConfig.author}`,
		description: 'Welcome to my collection of poems and verses.'
	}}
>
	<div
		class="flex min-h-screen w-screen max-w-[60rem] flex-col items-center px-6 pb-10 pt-7 font-satoshi text-[0.92rem] leading-relaxed selection:bg-red-500 selection:text-white sm:px-10 lg:px-10"
	>
		<div class="w-full">
			<Back />

			<div class="mt-5">
				<h1 class="mb-8 text-2xl font-bold">Written Poetry</h1>
				<div class="relative flex gap-6">
					<div class="sticky top-4 h-[calc(100vh-10rem)] w-64 overflow-hidden">
						<div class="h-full">
							<div class="h-full overflow-y-auto p-4">
								<nav class="space-y-1">
									{
										poemsValue.map((poem, index) => (
											<a
												href={`#poem-${index}`}
												class="block rounded-md px-3 py-2 text-sm text-muted-foreground transition-colors hover:bg-accent hover:text-accent-foreground"
											>
												{poem.data.name}
											</a>
										))
									}
								</nav>
							</div>
						</div>
					</div>
					<div class="flex-1 space-y-6">
						{poemsValue.map((poem, index) => <Poem poem={poem} id={`poem-${index}`} />)}
					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
		function updateActiveLink() {
			const sections = document.querySelectorAll('article[id]');
			const navLinks = document.querySelectorAll('nav a');

			let currentSectionId = '';
			const offset = window.innerHeight * 0.2;

			sections.forEach((section) => {
				const rect = section.getBoundingClientRect();
				if (rect.top <= offset && rect.bottom > offset) {
					currentSectionId = section.id;
				}
			});

			navLinks.forEach((link) => {
				const href = link.getAttribute('href');
				if (href === `#${currentSectionId}`) {
					link.classList.add('bg-accent', 'text-accent-foreground', 'font-medium');
				} else {
					link.classList.remove('bg-accent', 'text-accent-foreground', 'font-medium');
				}
			});
		}

		// Add scroll event listener with passive flag for better performance
		window.addEventListener('scroll', updateActiveLink, { passive: true });

		// Smooth scroll behavior
		document.querySelectorAll('nav a').forEach((link) => {
			link.addEventListener('click', (e) => {
				e.preventDefault();
				const href = link.getAttribute('href');
				if (!href) return;
				const target = document.querySelector(href);
				if (!target) return;
				target.scrollIntoView({
					behavior: 'smooth',
					block: 'start'
				});
			});
		});

		// Initial check for active link
		updateActiveLink();
	</script>
</Layout>
