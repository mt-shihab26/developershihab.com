---
import { siteConfig } from '@/config/site';

import poems from '@/lib/poems';

import Layout from '@/components/Layout.astro';
import Poem from '@/components/screens/poems/Poem.astro';

const poemsValue = await poems();

const createPoemId = (name: string) => name.toLowerCase().replace(/[^a-z0-9]/g, '-');
---

<Layout
	meta={{
		title: `Poetry Collection - ${siteConfig.author}`,
		description: 'Welcome to my collection of poems and verses.'
	}}
>
	<div
		class="flex min-h-screen w-screen max-w-[60rem] flex-col items-center px-6 pb-10 pt-7 font-satoshi text-[0.92rem] leading-relaxed selection:bg-red-500 selection:text-white sm:px-10 lg:px-10"
	>
		<div class="w-full">
			<a
				href="/"
				class="inline-flex items-center gap-x-1 rounded-lg border border-border bg-primary-foreground px-2 py-1 text-sm transition-all hover:bg-input"
			>
				<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24">
					<path
						fill="currentColor"
						d="m6.921 12.5l5.792 5.792L12 19l-7-7l7-7l.713.708L6.921 11.5H19v1z"></path>
				</svg>
				<p>Back</p>
			</a>

			<div class="flex flex-col">
				<h1 class="mb-8 mt-5 text-2xl font-bold">Poetry Collection</h1>

				<!-- Content Grid -->
				<div class="grid grid-cols-1 gap-6">
					<!-- Sidebar -->
					<aside class="rounded-xl border bg-card text-card-foreground shadow">
						<div class="p-4">
							<nav class="space-y-1">
								{
									poemsValue.map((poem) => (
										<a
											href={`#${createPoemId(poem.data.name)}`}
											class="block rounded-md px-3 py-2 text-sm text-muted-foreground transition-colors hover:bg-accent hover:text-accent-foreground"
										>
											{poem.data.name}
										</a>
									))
								}
							</nav>
						</div>
					</aside>

					<!-- Poems -->
					<div class="space-y-6">
						{poemsValue.map((poem) => <Poem poem={poem} id={createPoemId(poem.data.name)} />)}
					</div>
				</div>
			</div>
		</div>
	</div>
</Layout>

<script>
	// Smooth scroll behavior for anchor links
	document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
		anchor.addEventListener('click', function (e) {
			e.preventDefault();
			const targetId = this.getAttribute('href');
			if (targetId) {
				const targetElement = document.querySelector(targetId);
				if (targetElement) {
					targetElement.scrollIntoView({
						behavior: 'smooth',
						block: 'start'
					});
					// Update active link
					document.querySelectorAll('nav a').forEach((link) => {
						link.classList.remove('bg-accent', 'text-accent-foreground', 'font-medium');
					});
					this.classList.add('bg-accent', 'text-accent-foreground', 'font-medium');
				}
			}
		});
	});

	// Scroll spy
	const observerOptions = {
		root: null,
		rootMargin: '0px',
		threshold: 0.5
	};

	const observer = new IntersectionObserver((entries) => {
		entries.forEach((entry) => {
			if (entry.isIntersecting) {
				const id = entry.target.id;
				document.querySelectorAll('nav a').forEach((link) => {
					link.classList.remove('bg-accent', 'text-accent-foreground', 'font-medium');
					if (link.getAttribute('href') === `#${id}`) {
						link.classList.add('bg-accent', 'text-accent-foreground', 'font-medium');
					}
				});
			}
		});
	}, observerOptions);

	document.querySelectorAll('article[id]').forEach((section) => {
		observer.observe(section);
	});
</script>
